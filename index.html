<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Push Notification Example</title>
</head>
<body>

  <h1>Push Notification Example</h1>

  <button onclick="subscribeToPush()">Enable Push Notifications</button>

  <script>
    async function subscribeToPush() {
      try {
        const registration = await navigator.serviceWorker.register('service-worker.js');

        // Check if push is supported
        if (!('PushManager' in window)) {
          throw new Error('Push messaging is not supported');
        }

        // Check if there's an existing subscription
        const existingSubscription = await registration.pushManager.getSubscription();

        if (existingSubscription) {
          console.log('User is already subscribed to push notifications:', existingSubscription);
        } else {
          // Request permission to show push notifications
          const permission = await Notification.requestPermission();

          if (permission === 'granted') {
            // Replace 'YOUR_PUBLIC_KEY' with the actual public key generated from the Web Push VAPID Generator
            const publicKey = '_jehApUafq4We78MfNZyPl5j-LUtrDTsDbTO9eVYvP0';

            // Subscribe to push
            const subscription = await registration.pushManager.subscribe({
              userVisibleOnly: true,
              applicationServerKey: urlBase64ToUint8Array(publicKey),
            });

            console.log('Subscribed to push notifications:', subscription);
          } else {
            console.log('Permission for push notifications denied');
          }
        }
      } catch (error) {
        console.error('Error subscribing to push notifications:', error);
      }
    }

    function urlBase64ToUint8Array(base64String) {
      const padding = '='.repeat((4 - base64String.length % 4) % 4);
      const base64 = (base64String + padding)
        .replace(/\-/g, '+')
        .replace(/_/g, '/');

      const rawData = window.atob(base64);
      const outputArray = new Uint8Array(rawData.length);

      for (let i = 0; i < rawData.length; ++i) {
        outputArray[i] = rawData.charCodeAt(i);
      }

      return outputArray;
    }
  </script>

</body>
</html>
